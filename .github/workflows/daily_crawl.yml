name: Daily PR TIMES Crawling

on:
  schedule:
    # í•œêµ­ ì‹œê°„(KST) ì˜¤ì „ 9ì‹œ (UTC 00:00)
    - cron: '0 0 * * *'
  workflow_dispatch: # ì§ì ‘ 'Run' ë²„íŠ¼ì„ ëˆŒëŸ¬ í…ŒìŠ¤íŠ¸í•´ë³¼ ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas playwright googletrans==4.0.0-rc1

    - name: Install Playwright Browsers
      run: |
        playwright install chromium --with-deps

    - name: Run Crawler
      run: |
        python prtimes_beauty_crawler.py 

    - name: Send Email with Date CSV ğŸŒ¸
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.gmail.com
        server_port: 465
        username: ${{ secrets.MAIL_USERNAME }}
        password: ${{ secrets.MAIL_PASSWORD }}
        subject: "ğŸŒ¸ ì£¼ì¸ë‹˜! ì˜¤ëŠ˜ì ë·°í‹° ë‰´ìŠ¤ ë°°ë‹¬ì™”ì–´ìš”! ğŸŒ¸"
        body: |
          ì•ˆë…•í•˜ì„¸ìš”, ì£¼ì¸ë‹˜! ğŸ¤–
          ì˜¤ëŠ˜ë„ ì •ì„±ê» ìˆ˜ì§‘í•œ ë·°í‹° ë‰´ìŠ¤ CSV íŒŒì¼ì„ ì²¨ë¶€í•©ë‹ˆë‹¤.
          í–‰ë³µí•œ í•˜ë£¨ ë˜ì„¸ìš”! âœ¨
        to: ${{ secrets.MAIL_USERNAME }}
        from: "í–‰ë³µí•œ í¬ë¡¤ëŸ¬ ë´‡"
        attachments: "*.csv"    

    - name: Commit and Push CSV
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        # íŒŒì¼ëª…ì´ ë§¤ì¼ ë‹¬ë¼ì§€ë¯€ë¡œ ëª¨ë“  CSVë¥¼ ì¶”ê°€í•˜ë„ë¡ ìˆ˜ì •!
        git add *.csv 
        git commit -m "Auto-update: $(date +'%Y-%m-%d')" || echo "No changes to commit"
        git push
