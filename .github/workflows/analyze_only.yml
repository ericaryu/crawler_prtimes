name: Analyze Only (ìˆ˜ë™)
on:
  workflow_dispatch:
    inputs:
      raw_filename:
        description: 'ë¶„ì„í•  raw íŒŒì¼ëª… (ì˜ˆ: raw_2026-02-10.csv)'
        required: true
        default: 'raw_2026-02-10.csv'

jobs:
  analyze:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Upload raw CSV        # â† ë¡œì»¬ì—ì„œ raw íŒŒì¼ì„ ë ˆí¬ì— ì»¤ë°‹í•´ë‘¬ì•¼ í•¨
      run: |
        ls ${{ github.event.inputs.raw_filename }}

    - name: Run Analyzer
      env:
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      run: |
        python 02_analyzer.py "${{ github.event.inputs.raw_filename }}"

    - name: Send Email
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.gmail.com
        server_port: 465
        username: ${{ secrets.MAIL_USERNAME }}
        password: ${{ secrets.MAIL_PASSWORD }}
        subject: "ğŸŒ¸ ë¶„ì„ ì™„ë£Œ! ${{ github.event.inputs.raw_filename }}"
        body: "ìˆ˜ë™ ì‹¤í–‰ ë¶„ì„ ê²°ê³¼ì…ë‹ˆë‹¤."
        to: ${{ secrets.MAIL_USERNAME }}
        from: "ëŒì•„ë¼ ì¼ë³¸ PR í¬ë¡¤ëŸ¬ ë´‡"
        attachments: "final_[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9].csv"
